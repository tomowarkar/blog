<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="データサイエンス 100 本ノックとは The-Japan-DataScientist-Society/100knocks-preprocess: データサイエンス 100 本ノック（構造化データ加工編） Google Colab で データサイエンス 100 本ノックをするにあたって 以下の ipynb ファ" />
<meta name="keywords" content=", python, 100knocks" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://tomowarkar.github.io/blog/posts/ds100-04/" />


    <title>
        
            データサイエンス100本ノックをPythonでやってみた [31-40] :: tomowarkarの技術ブログ  — ３歩進んで２歩下がる
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://tomowarkar.github.io/blog/main.min.84ed5579024525d4b50458514d1a43e40dd5272df45c7cd6da85b225af457154.css">




<meta itemprop="name" content="データサイエンス100本ノックをPythonでやってみた [31-40]">
<meta itemprop="description" content="データサイエンス 100 本ノックとは The-Japan-DataScientist-Society/100knocks-preprocess: データサイエンス 100 本ノック（構造化データ加工編） Google Colab で データサイエンス 100 本ノックをするにあたって 以下の ipynb ファ">
<meta itemprop="datePublished" content="2020-06-22T00:00:00&#43;09:00" />
<meta itemprop="dateModified" content="2020-06-22T00:00:00&#43;09:00" />
<meta itemprop="wordCount" content="1961">
<meta itemprop="image" content="https://tomowarkar.github.io/blog/"/>



<meta itemprop="keywords" content="python,100knocks," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://tomowarkar.github.io/blog/"/>

<meta name="twitter:title" content="データサイエンス100本ノックをPythonでやってみた [31-40]"/>
<meta name="twitter:description" content="データサイエンス 100 本ノックとは The-Japan-DataScientist-Society/100knocks-preprocess: データサイエンス 100 本ノック（構造化データ加工編） Google Colab で データサイエンス 100 本ノックをするにあたって 以下の ipynb ファ"/>





    <meta property="article:published_time" content="2020-06-22 00:00:00 &#43;0900 JST" />









<script async src="https://www.googletagmanager.com/gtag/js?id=UA-130237515-2"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-130237515-2');
</script>
    </head>

    <body class="">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://tomowarkar.github.io/blog/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">tomowarkar</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://tomowarkar.github.io/blog/posts">Blog</a></li><li><a href="https://tomowarkar.github.io/blog/tags">Tags</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>4 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title">
                <a href="https://tomowarkar.github.io/blog/posts/ds100-04/">データサイエンス100本ノックをPythonでやってみた [31-40]</a>
            </h1>
                <hr />
                <aside id="toc">
                <div class="toc-title">目次</div>
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#データサイエンス-100-本ノックとは">データサイエンス 100 本ノックとは</a>
      <ul>
        <li><a href="#google-colab-で-データサイエンス-100-本ノックをするにあたって">Google Colab で データサイエンス 100 本ノックをするにあたって</a></li>
        <li><a href="#実行ファイル">実行ファイル</a></li>
      </ul>
    </li>
    <li><a href="#031">031</a></li>
    <li><a href="#032">032</a></li>
    <li><a href="#033">033</a></li>
    <li><a href="#034">034</a></li>
    <li><a href="#035">035</a></li>
    <li><a href="#036">036</a></li>
    <li><a href="#037">037</a>
      <ul>
        <li><a href="#別解">別解</a></li>
      </ul>
    </li>
    <li><a href="#038">038</a></li>
    <li><a href="#039">039</a>
      <ul>
        <li><a href="#別解-1">別解</a></li>
      </ul>
    </li>
    <li><a href="#040">040</a>
      <ul>
        <li><a href="#別解-2">別解</a></li>
      </ul>
    </li>
  </ul>
</nav>
                </aside>
                <hr />

            

            <div class="post-content">
                <h2 id="データサイエンス-100-本ノックとは">データサイエンス 100 本ノックとは</h2>
<p><a href="https://github.com/The-Japan-DataScientist-Society/100knocks-preprocess">The-Japan-DataScientist-Society/100knocks-preprocess: データサイエンス 100 本ノック（構造化データ加工編）</a></p>
<h3 id="google-colab-で-データサイエンス-100-本ノックをするにあたって">Google Colab で データサイエンス 100 本ノックをするにあたって</h3>
<p>以下の ipynb ファイルを使用させていただきました。</p>
<p><a href="https://github.com/noguhiro2002/100knocks-preprocess_ForColab-AzureNotebook">noguhiro2002/100knocks-preprocess_ForColab-AzureNotebook: データサイエンス 100 本ノック（構造化データ加工編）For Azure_Notebook/Google_Colabo</a></p>
<h3 id="実行ファイル">実行ファイル</h3>
<p><a href="https://colab.research.google.com/drive/1BFlAbxy3zLfDH_UtrhiGb7iz6mmPF5t1?usp=sharing">データサイエンス 100 本ノック by tomowarkar</a></p>
<h2 id="031">031</h2>
<blockquote>
<p>P-031: レシート明細データフレーム（df_receipt）に対し、店舗コード（store_cd）ごとに売上金額（amount）の標本標準偏差を計算し、降順で TOP5 を表示せよ。</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_receipt<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#34;store_cd&#34;</span>)\
  <span style="color:#f92672">.</span>agg(sample_std<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#34;amount&#34;</span>, <span style="color:#66d9ef">lambda</span> x: x<span style="color:#f92672">.</span>std(ddof<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)))\
  <span style="color:#f92672">.</span>sort_values(<span style="color:#e6db74">&#34;sample_std&#34;</span>, ascending<span style="color:#f92672">=</span>False)<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">5</span>)
</code></pre></div><pre><code>          sample_std
store_cd
S13052    663.391816
S14011    553.456916
S14034    544.903736
S13001    543.536561
S13015    543.409938
</code></pre><h2 id="032">032</h2>
<blockquote>
<p>P-032: レシート明細データフレーム（df_receipt）の売上金額（amount）について、25％刻みでパーセンタイル値を求めよ。</p>
</blockquote>
<p><code>pandas.Series.quantile</code>を使います。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_receipt<span style="color:#f92672">.</span>amount<span style="color:#f92672">.</span>quantile([i<span style="color:#f92672">/</span><span style="color:#ae81ff">100</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">101</span>, <span style="color:#ae81ff">25</span>)])
</code></pre></div><pre><code>0.00       10.0
0.25      102.0
0.50      170.0
0.75      288.0
1.00    10925.0
Name: amount, dtype: float64
</code></pre><h2 id="033">033</h2>
<blockquote>
<p>P-033: レシート明細データフレーム（df_receipt）に対し、店舗コード（store_cd）ごとに売上金額（amount）の平均を計算し、330 以上のものを抽出せよ。</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_receipt<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#34;store_cd&#34;</span>)\
  <span style="color:#f92672">.</span>agg(mean_amount<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#34;amount&#34;</span>, <span style="color:#e6db74">&#34;mean&#34;</span>))\
  <span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#34;mean_amount &gt;= 330&#34;</span>)
</code></pre></div><pre><code>          mean_amount
store_cd
S12013     330.194130
S13001     348.470386
S13003     350.915519
S13004     330.943949
S13015     351.111960
S13019     330.208616
S13020     337.879932
S13052     402.867470
S14010     348.791262
S14011     335.718333
S14026     332.340588
S14045     330.082073
S14047     330.077073
</code></pre><h2 id="034">034</h2>
<blockquote>
<p>P-034: レシート明細データフレーム（df_receipt）に対し、顧客 ID（customer_id）ごとに売上金額（amount）を合計して全顧客の平均を求めよ。ただし、顧客 ID が&quot;Z&quot;から始まるのものは非会員を表すため、除外して計算すること。</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_receipt[<span style="color:#f92672">~</span>df_receipt<span style="color:#f92672">.</span>customer_id<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;Z&#34;</span>)]\
  <span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#34;customer_id&#34;</span>)<span style="color:#f92672">.</span>amount<span style="color:#f92672">.</span>sum()<span style="color:#f92672">.</span>mean() <span style="color:#75715e">#&gt; 2547.742234529256</span>
</code></pre></div><h2 id="035">035</h2>
<blockquote>
<p>P-035: レシート明細データフレーム（df_receipt）に対し、顧客 ID（customer_id）ごとに売上金額（amount）を合計して全顧客の平均を求め、平均以上に買い物をしている顧客を抽出せよ。ただし、顧客 ID が&quot;Z&quot;から始まるのものは非会員を表すため、除外して計算すること。なお、データは 10 件だけ表示させれば良い。</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">mean_amount <span style="color:#f92672">=</span> df_receipt[<span style="color:#f92672">~</span>df_receipt<span style="color:#f92672">.</span>customer_id<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;Z&#34;</span>)]\
  <span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#34;customer_id&#34;</span>)<span style="color:#f92672">.</span>amount<span style="color:#f92672">.</span>sum()<span style="color:#f92672">.</span>mean()

df_receipt[<span style="color:#f92672">~</span>df_receipt<span style="color:#f92672">.</span>customer_id<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;Z&#34;</span>)]\
  <span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#34;customer_id&#34;</span>)\
  <span style="color:#f92672">.</span>agg({<span style="color:#e6db74">&#34;amount&#34;</span>:<span style="color:#e6db74">&#34;sum&#34;</span>})\
  <span style="color:#f92672">.</span>query(f<span style="color:#e6db74">&#34;amount &gt;= {mean_amount}&#34;</span>)<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">10</span>)
</code></pre></div><pre><code>                amount
customer_id
CS001115000010    3044
CS001205000006    3337
CS001214000009    4685
CS001214000017    4132
CS001214000052    5639
CS001215000040    3496
CS001304000006    3726
CS001305000005    3485
CS001305000011    4370
CS001315000180    3300
</code></pre><h2 id="036">036</h2>
<blockquote>
<p>P-036: レシート明細データフレーム（df_receipt）と店舗データフレーム（df_store）を内部結合し、レシート明細データフレームの全項目と店舗データフレームの店舗名（store_name）を 10 件表示させよ。</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">pd<span style="color:#f92672">.</span>merge(
    df_receipt,
    df_store[[<span style="color:#e6db74">&#39;store_cd&#39;</span>,<span style="color:#e6db74">&#39;store_name&#39;</span>]],
    how<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;inner&#39;</span>,
    on<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_cd&#39;</span>
)<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">10</span>)
</code></pre></div><pre><code>   sales_ymd  sales_epoch store_cd  ...  quantity  amount store_name
0   20181103   1257206400   S14006  ...         1     158       葛が谷店
1   20181116   1258329600   S14006  ...         1      48       葛が谷店
2   20170118   1200614400   S14006  ...         1     220       葛が谷店
3   20190524   1274659200   S14006  ...         1      80       葛が谷店
4   20190419   1271635200   S14006  ...         1     148       葛が谷店
5   20181119   1258588800   S14006  ...         1      88       葛が谷店
6   20171211   1228953600   S14006  ...         1      80       葛が谷店
7   20191021   1287619200   S14006  ...         1     405       葛が谷店
8   20170710   1215648000   S14006  ...         1     330       葛が谷店
9   20190805   1280966400   S14006  ...         1     115       葛が谷店

[10 rows x 10 columns]
</code></pre><h2 id="037">037</h2>
<blockquote>
<p>P-037: 商品データフレーム（df_product）とカテゴリデータフレーム（df_category）を内部結合し、商品データフレームの全項目とカテゴリデータフレームの小区分名（category_small_name）を 10 件表示させよ。</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">pd<span style="color:#f92672">.</span>merge(
  df_product,
  df_category[[<span style="color:#e6db74">&#39;category_small_cd&#39;</span>,<span style="color:#e6db74">&#39;category_small_name&#39;</span>]],
  how<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;inner&#39;</span>,
  on<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;category_small_cd&#39;</span>
)<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">10</span>)
</code></pre></div><pre><code>   product_cd  category_major_cd  ...  unit_cost  category_small_name
0  P040101001                  4  ...      149.0                  弁当類
1  P040101002                  4  ...      164.0                  弁当類
2  P040101003                  4  ...      173.0                  弁当類
3  P040101004                  4  ...      186.0                  弁当類
4  P040101005                  4  ...      201.0                  弁当類
5  P040101006                  4  ...      224.0                  弁当類
6  P040101007                  4  ...      254.0                  弁当類
7  P040101008                  4  ...      315.0                  弁当類
8  P040101009                  4  ...      374.0                  弁当類
9  P040101010                  4  ...      435.0                  弁当類

[10 rows x 7 columns]
</code></pre><h3 id="別解">別解</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">tmp <span style="color:#f92672">=</span> list(set(df_product<span style="color:#f92672">.</span>columns) <span style="color:#f92672">&amp;</span> set(df_category<span style="color:#f92672">.</span>columns))
pd<span style="color:#f92672">.</span>merge(df_product, df_category[tmp<span style="color:#f92672">+</span>[<span style="color:#e6db74">&#39;category_small_name&#39;</span>]], how<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;inner&#39;</span>, on<span style="color:#f92672">=</span>tmp)<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">10</span>)
</code></pre></div><h2 id="038">038</h2>
<blockquote>
<p>P-038: 顧客データフレーム（df_customer）とレシート明細データフレーム（df_receipt）から、各顧客ごとの売上金額合計を求めよ。ただし、買い物の実績がない顧客については売上金額を 0 として表示させること。また、顧客は性別コード（gender_cd）が女性（1）であるものを対象とし、非会員（顧客 ID が&rsquo;Z'から始まるもの）は除外すること。なお、結果は 10 件だけ表示させれば良い。</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">pd<span style="color:#f92672">.</span>merge(
  df_customer[(<span style="color:#f92672">~</span>df_customer<span style="color:#f92672">.</span>customer_id<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;Z&#34;</span>)) <span style="color:#f92672">&amp;</span> (df_customer<span style="color:#f92672">.</span>gender_cd <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>)]<span style="color:#f92672">.</span>customer_id,
  df_receipt<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#34;customer_id&#34;</span>)<span style="color:#f92672">.</span>agg({<span style="color:#e6db74">&#34;amount&#34;</span>: <span style="color:#e6db74">&#34;sum&#34;</span>}),
  how<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;left&#39;</span>,
  on<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;customer_id&#39;</span>
)<span style="color:#f92672">.</span>fillna(<span style="color:#ae81ff">0</span>)<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">10</span>)
</code></pre></div><pre><code>      customer_id  amount
0  CS021313000114     0.0
1  CS031415000172  5088.0
2  CS028811000001     0.0
3  CS001215000145   875.0
4  CS015414000103  3122.0
5  CS033513000180   868.0
6  CS035614000014     0.0
7  CS011215000048  3444.0
8  CS009413000079     0.0
9  CS040412000191   210.0
</code></pre><h2 id="039">039</h2>
<blockquote>
<p>P-039: レシート明細データフレーム（df_receipt）から売上日数の多い顧客の上位 20 件と、売上金額合計の多い顧客の上位 20 件を抽出し、完全外部結合せよ。ただし、非会員（顧客 ID が&rsquo;Z'から始まるもの）は除外すること。</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">group <span style="color:#f92672">=</span> df_receipt[(<span style="color:#f92672">~</span>df_receipt<span style="color:#f92672">.</span>customer_id<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;Z&#34;</span>))]<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#34;customer_id&#34;</span>)
pd<span style="color:#f92672">.</span>merge(
  group<span style="color:#f92672">.</span>agg({<span style="color:#e6db74">&#34;amount&#34;</span>:<span style="color:#e6db74">&#34;sum&#34;</span>})<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#39;amount.rank(ascending=False, method=&#34;first&#34;) &lt;= 20&#39;</span>, engine<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;python&#34;</span>),
  group<span style="color:#f92672">.</span>agg({<span style="color:#e6db74">&#34;sales_ymd&#34;</span>:<span style="color:#e6db74">&#34;nunique&#34;</span>})<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#39;sales_ymd.rank(ascending=False, method=&#34;first&#34;) &lt;= 20&#39;</span>, engine<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;python&#34;</span>),
  how<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;outer&#39;</span>,
  on<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;customer_id&#39;</span>
)
</code></pre></div><pre><code>                 amount  sales_ymd
customer_id
CS001605000009  18925.0        NaN
CS006515000023  18372.0        NaN
CS007514000094  15735.0        NaN
CS009414000059  15492.0        NaN
CS010214000010  18585.0       22.0
CS011414000106  18338.0        NaN
CS011415000006  16094.0        NaN
CS015415000185  20153.0       22.0
CS015515000034  15300.0        NaN
CS016415000101  16348.0        NaN
CS016415000141  18372.0       20.0
CS017415000097  23086.0       20.0
CS021515000089  17580.0        NaN
CS028415000007  19127.0       21.0
CS030415000034  15468.0        NaN
CS031414000051  19202.0       19.0
CS032414000072  16563.0        NaN
CS034415000047  16083.0        NaN
CS035414000024  17615.0        NaN
CS038415000104  17847.0        NaN
CS007515000107      NaN       18.0
CS010214000002      NaN       21.0
CS014214000023      NaN       19.0
CS014415000077      NaN       18.0
CS021514000045      NaN       19.0
CS021515000056      NaN       18.0
CS021515000172      NaN       19.0
CS021515000211      NaN       18.0
CS022515000028      NaN       18.0
CS022515000226      NaN       19.0
CS030214000008      NaN       18.0
CS031414000073      NaN       18.0
CS039414000052      NaN       19.0
CS040214000008      NaN       23.0
</code></pre><h3 id="別解-1">別解</h3>
<p>こっちのがシュッとしている</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_receipt[(<span style="color:#f92672">~</span>df_receipt<span style="color:#f92672">.</span>customer_id<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;Z&#34;</span>))]\
  <span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#34;customer_id&#34;</span>)\
  <span style="color:#f92672">.</span>agg({<span style="color:#e6db74">&#34;amount&#34;</span>:<span style="color:#e6db74">&#34;sum&#34;</span>, <span style="color:#e6db74">&#34;sales_ymd&#34;</span>:<span style="color:#e6db74">&#34;nunique&#34;</span>})\
  <span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#39;amount.rank(ascending=False, method=&#34;first&#34;) &lt;= 20 | sales_ymd.rank(ascending=False, method=&#34;first&#34;) &lt;= 20&#39;</span>, engine<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;python&#34;</span>
)
</code></pre></div><pre><code>                amount  sales_ymd
customer_id
CS001605000009   18925          9
CS006515000023   18372         15
CS007514000094   15735         13
CS007515000107   11188         18
CS009414000059   15492         17
CS010214000002   13120         21
CS010214000010   18585         22
CS011414000106   18338         16
CS011415000006   16094         11
CS014214000023    8405         19
CS014415000077   14076         18
CS015415000185   20153         22
CS015515000034   15300          7
CS016415000101   16348         12
CS016415000141   18372         20
CS017415000097   23086         20
CS021514000045    9741         19
CS021515000056   12036         18
CS021515000089   17580         12
CS021515000172   13974         19
CS021515000211   10148         18
CS022515000028   13512         18
CS022515000226    8556         19
CS028415000007   19127         21
CS030214000008   10357         18
CS030415000034   15468         13
CS031414000051   19202         19
CS031414000073    9317         18
CS032414000072   16563         13
CS034415000047   16083         14
CS035414000024   17615         11
CS038415000104   17847         14
CS039414000052   11438         19
CS040214000008   13523         23
</code></pre><h2 id="040">040</h2>
<blockquote>
<p>P-040: 全ての店舗と全ての商品を組み合わせると何件のデータとなるか調査したい。店舗（df_store）と商品（df_product）を直積した件数を計算せよ。</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">len(set(df_store<span style="color:#f92672">.</span>store_cd)) <span style="color:#f92672">*</span> len(set(df_product<span style="color:#f92672">.</span>product_cd)) <span style="color:#75715e">#&gt;531590</span>
</code></pre></div><h3 id="別解-2">別解</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> itertools <span style="color:#f92672">import</span> product
pd<span style="color:#f92672">.</span>DataFrame(
  product(df_store<span style="color:#f92672">.</span>store_cd, df_product<span style="color:#f92672">.</span>product_cd),
  columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;store_cd&#39;</span>, <span style="color:#e6db74">&#39;product_cd&#39;</span>]
)
</code></pre></div>
            </div>
        </article>

        <hr />

        <div class="post-info">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://tomowarkar.github.io/blog/tags/python">python</a></span><span class="tag"><a href="https://tomowarkar.github.io/blog/tags/100knocks">100knocks</a></span>
                </p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>1961 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2020-06-22 00:00 &#43;0900</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h">Read other posts</span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="https://tomowarkar.github.io/blog/posts/ds100-06/">
                                <span class="button__icon">←</span>
                                <span class="button__text">データサイエンス100本ノックをPythonでやってみた [51-60]</span>
                            </a>
                        </span>
                    

                    
                        <span class="button next">
                            <a href="https://tomowarkar.github.io/blog/posts/ds100-01/">
                                <span class="button__text">データサイエンス100本ノックをPythonでやってみた [1-10]</span>
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    
                </div>
            </div>
        
    </main>
    <div><style>
        .bmc-button img {
            height: 34px !important;
            width: 35px !important;
            margin-bottom: 1px !important;
            box-shadow: none !important;
            border: none !important;
            vertical-align: middle !important;
        }
    
        .bmc-button {
            padding: 7px 10px 7px 10px !important;
            line-height: 35px !important;
            height: 51px !important;
            min-width: 217px !important;
            text-decoration: none !important;
            display: inline-flex !important;
            color: #ffffff !important;
            background-color: #FF5F5F !important;
            border-radius: 5px !important;
            border: 1px solid transparent !important;
            padding: 7px 10px 7px 10px !important;
            font-size: 20px !important;
            letter-spacing: 0.6px !important;
            box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;
            -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
            margin: 0 auto !important;
            font-family: 'Arial', cursive !important;
            -webkit-box-sizing: border-box !important;
            box-sizing: border-box !important;
            -o-transition: 0.3s all linear !important;
            -webkit-transition: 0.3s all linear !important;
            -moz-transition: 0.3s all linear !important;
            -ms-transition: 0.3s all linear !important;
            transition: 0.3s all linear !important;
        }
    
        .bmc-button:hover,
        .bmc-button:active,
        .bmc-button:focus {
            -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
            text-decoration: none !important;
            box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
            opacity: 0.85 !important;
            color: #ffffff !important;
        }
    </style>
    <link href="https://fonts.googleapis.com/css?family=Arial" rel="stylesheet"><a class="bmc-button" target="_blank"
        href="https://www.buymeacoffee.com/tomowarkar"><img src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg"
            alt="Buy me a coffee"><span style="margin-left:15px;font-size:19px !important;">Buy me a coffee</span></a></div>

            </div>

            
                <footer class="footer">
  <div class="footer__inner">
    <div class="footer__content">
      <span>&copy; 2020</span>
      
      <span>tomowarkar</span>
      
    </div>
  </div>
  <div class="footer__inner">
    <div class="footer__content">
      
    </div>
  </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="https://tomowarkar.github.io/blog/bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js" integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script>



    </body>
</html>
