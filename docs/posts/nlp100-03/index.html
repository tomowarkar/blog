<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="言語処理 100 本ノック(第 3 章: 正規表現) Wikipedia の記事を以下のフォーマットで書き出したファイルjawiki-country.json.gzがある． 1" />
<meta name="keywords" content=", nlp, python, regex" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://tomowarkar.github.io/blog/posts/nlp100-03/" />


    <title>
        
            今さら言語処理100本ノック #03 :: tomowarkarの技術ブログ  — ３歩進んで２歩下がる
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://tomowarkar.github.io/blog/main.min.84ed5579024525d4b50458514d1a43e40dd5272df45c7cd6da85b225af457154.css">




<meta itemprop="name" content="今さら言語処理100本ノック #03">
<meta itemprop="description" content="言語処理 100 本ノック(第 3 章: 正規表現) Wikipedia の記事を以下のフォーマットで書き出したファイルjawiki-country.json.gzがある． 1">
<meta itemprop="datePublished" content="2020-04-23T14:16:41&#43;09:00" />
<meta itemprop="dateModified" content="2020-04-23T14:16:41&#43;09:00" />
<meta itemprop="wordCount" content="5551">
<meta itemprop="image" content="https://tomowarkar.github.io/blog/"/>



<meta itemprop="keywords" content="nlp,python,regex," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://tomowarkar.github.io/blog/"/>

<meta name="twitter:title" content="今さら言語処理100本ノック #03"/>
<meta name="twitter:description" content="言語処理 100 本ノック(第 3 章: 正規表現) Wikipedia の記事を以下のフォーマットで書き出したファイルjawiki-country.json.gzがある． 1"/>





    <meta property="article:published_time" content="2020-04-23 14:16:41 &#43;0900 JST" />









<script async src="https://www.googletagmanager.com/gtag/js?id=UA-130237515-2"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-130237515-2');
</script>
    </head>

    <body class="">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://tomowarkar.github.io/blog/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">tomowarkar</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://tomowarkar.github.io/blog/posts">Blog</a></li><li><a href="https://tomowarkar.github.io/blog/tags">Tags</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>12 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title">
                <a href="https://tomowarkar.github.io/blog/posts/nlp100-03/">今さら言語処理100本ノック #03</a>
            </h1>

            

            <div class="post-content">
                <h2 id="言語処理-100-本ノック第-3-章-正規表現httpsnlp100githubiojach03html"><a href="https://nlp100.github.io/ja/ch03.html">言語処理 100 本ノック(第 3 章: 正規表現)</a></h2>
<blockquote>
<p>Wikipedia の記事を以下のフォーマットで書き出したファイル<a href="https://nlp100.github.io/data/jawiki-country.json.gz">jawiki-country.json.gz</a>がある．
1 行に 1 記事の情報が JSON 形式で格納される
各行には記事名が”title”キーに，記事本文が”text”キーの辞書オブジェクトに格納され，そのオブジェクトが JSON 形式で書き出される
ファイル全体は gzip で圧縮される
以下の処理を行うプログラムを作成せよ．</p>
</blockquote>
<h3 id="環境">環境</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.4
BuildVersion:   19E266

$ python3 -V
Python 3.6.8
</code></pre></div><h3 id="20-json-データの読み込み">20. JSON データの読み込み</h3>
<p>Wikipedia 記事の JSON ファイルを読み込み，「イギリス」に関する記事本文を表示せよ．問題 21-29 では，ここで抽出した記事本文に対して実行せよ．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> gzip
<span style="color:#f92672">import</span> json

<span style="color:#66d9ef">with</span> gzip<span style="color:#f92672">.</span>open(<span style="color:#e6db74">&#34;jawiki-country.json.gz&#34;</span>, <span style="color:#e6db74">&#34;rt&#34;</span>) <span style="color:#66d9ef">as</span> f:
    lines <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>readlines()

lines <span style="color:#f92672">=</span> list(map(<span style="color:#66d9ef">lambda</span> x: json<span style="color:#f92672">.</span>loads(x), lines))
uk, <span style="color:#f92672">*</span>_ <span style="color:#f92672">=</span> list(filter(<span style="color:#66d9ef">lambda</span> x: x<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;title&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;イギリス&#34;</span>, lines))

uk_text <span style="color:#f92672">=</span> uk<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;text&#34;</span>)
<span style="color:#66d9ef">print</span>(uk_text)
</code></pre></div><h4 id="out">out</h4>
<pre><code>{{redirect|UK}}
{{redirect|英国|春秋時代の諸侯国|英 (春秋)}}
{{Otheruses|ヨーロッパの国|長崎県・熊本県の郷土料理|いぎりす}}
{{基礎情報 国
|略名  =イギリス
...
</code></pre><h3 id="21-カテゴリ名を含む行を抽出">21. カテゴリ名を含む行を抽出</h3>
<p>記事中でカテゴリ名を宣言している行を抽出せよ．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> re
category_lines <span style="color:#f92672">=</span> list(filter(<span style="color:#66d9ef">lambda</span> x:re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;\[\[Category:.*?\]\]&#34;</span>, x), uk_text<span style="color:#f92672">.</span>splitlines()))
<span style="color:#66d9ef">print</span>(<span style="color:#f92672">*</span>category_lines, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</code></pre></div><h4 id="out-1">out</h4>
<pre><code>[[Category:イギリス|*]]
[[Category:イギリス連邦加盟国]]
[[Category:英連邦王国|*]]
[[Category:G8加盟国]]
[[Category:欧州連合加盟国|元]]
[[Category:海洋国家]]
[[Category:現存する君主国]]
[[Category:島国]]
[[Category:1801年に成立した国家・領域]]
</code></pre><h3 id="22-カテゴリ名の抽出-permalink">22. カテゴリ名の抽出 Permalink</h3>
<p>記事のカテゴリ名を（行単位ではなく名前で）抽出せよ．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">categories <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;\[\[Category:(.*?)\]\]&#34;</span>, uk_text)
<span style="color:#66d9ef">print</span>(<span style="color:#f92672">*</span>categories, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</code></pre></div><h4 id="out-2">out</h4>
<pre><code>イギリス|*
イギリス連邦加盟国
英連邦王国|*
G8加盟国
欧州連合加盟国|元
海洋国家
現存する君主国
島国
1801年に成立した国家・領域
</code></pre><h4 id="純粋なカテゴリ名を取得">純粋なカテゴリ名を取得</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">categories <span style="color:#f92672">=</span> [c <span style="color:#66d9ef">for</span> c, _ <span style="color:#f92672">in</span> re<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;\[\[Category:(.*?)(\|.*)?\]\]&#34;</span>, uk_text)]
<span style="color:#66d9ef">print</span>(<span style="color:#f92672">*</span>categories, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</code></pre></div><h4 id="out-3">out</h4>
<pre><code>イギリス
イギリス連邦加盟国
英連邦王国
G8加盟国
欧州連合加盟国
海洋国家
現存する君主国
島国
1801年に成立した国家・領域
</code></pre><h3 id="23-セクション構造-permalink">23. セクション構造 Permalink</h3>
<p>記事中に含まれるセクション名とそのレベル（例えば”== セクション名 ==”なら 1）を表示せよ．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">sections <span style="color:#f92672">=</span> list(filter(<span style="color:#66d9ef">lambda</span> x: re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;^=(.+)=$&#34;</span>, x), uk_text<span style="color:#f92672">.</span>splitlines()))
section_levels <span style="color:#f92672">=</span> [(section<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;=&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>), section<span style="color:#f92672">.</span>count(<span style="color:#e6db74">&#34;=&#34;</span>)<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">for</span> section <span style="color:#f92672">in</span> sections]
<span style="color:#66d9ef">print</span>(<span style="color:#f92672">*</span>section_levels, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</code></pre></div><h4 id="きれいに書くならこう">きれいに書くならこう?</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"> section_structure <span style="color:#f92672">=</span> [(j, len(i) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">for</span> i, j <span style="color:#f92672">in</span> re<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;(=+)(.*?)\1\n&#34;</span>, uk_text)]
 <span style="color:#66d9ef">print</span>(<span style="color:#f92672">*</span>section_structure, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</code></pre></div><h4 id="out-4">out</h4>
<pre><code>('国名', 1)
('歴史', 1)
('地理', 1)
('主要都市', 2)
('気候', 2)
('政治', 1)
('元首', 2)
('法', 2)
('内政', 2)
('地方行政区分', 2)
('外交・軍事', 2)
('経済', 1)
('鉱業', 2)
('農業', 2)
('貿易', 2)
('不動産', 2)
('エネルギー政策', 2)
('通貨', 2)
('企業', 2)
('通信', 3)
('交通', 1)
('道路', 2)
('鉄道', 2)
('海運', 2)
('航空', 2)
('科学技術', 1)
('国民', 1)
('言語', 2)
('宗教', 2)
('婚姻', 2)
('移住', 2)
('教育', 2)
('医療', 2)
('文化', 1)
('食文化', 2)
('文学', 2)
('哲学', 2)
('音楽', 2)
('ポピュラー音楽', 3)
('映画', 2)
('コメディ', 2)
('国花', 2)
('世界遺産', 2)
('祝祭日', 2)
('スポーツ', 2)
('サッカー', 3)
('クリケット', 3)
('競馬', 3)
('モータースポーツ', 3)
('野球', 3)
(' カーリング ', 3)
(' 自転車競技 ', 3)
('脚注', 1)
('関連項目', 1)
('外部リンク', 1)
</code></pre><h5 id="memo">memo</h5>
<ul>
<li>空白対処しないとなぁ</li>
</ul>
<h3 id="24-ファイル参照の抽出">24. ファイル参照の抽出</h3>
<p>記事から参照されているメディアファイルをすべて抜き出せ．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">media_files <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;\[\[ファイル:([^|\]]*)&#34;</span>, uk_text)
<span style="color:#66d9ef">print</span>(<span style="color:#f92672">*</span>media_files, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</code></pre></div><h4 id="out-5">out</h4>
<pre><code>Royal Coat of Arms of the United Kingdom.svg
United States Navy Band - God Save the Queen.ogg
Descriptio Prime Tabulae Europae.jpg
Lenepveu, Jeanne d'Arc au siège d'Orléans.jpg
London.bankofengland.arp.jpg
Battle of Waterloo 1815.PNG
Uk topo en.jpg
BenNevis2005.jpg
Population density UK 2011 census.png
2019 Greenwich Peninsula &amp; Canary Wharf.jpg
Birmingham Skyline from Edgbaston Cricket Ground crop.jpg
Leeds CBD at night.jpg
Glasgow and the Clyde from the air (geograph 4665720).jpg
Palace of Westminster, London - Feb 2007.jpg
Scotland Parliament Holyrood.jpg
Donald Trump and Theresa May (33998675310) (cropped).jpg
Soldiers Trooping the Colour, 16th June 2007.jpg
City of London skyline from London City Hall - Oct 2008.jpg
Oil platform in the North SeaPros.jpg
Eurostar at St Pancras Jan 2008.jpg
Heathrow Terminal 5C Iwelumo-1.jpg
Airbus A380-841 G-XLEB British Airways (10424102995).jpg
UKpop.svg
Anglospeak.svg
Royal Aberdeen Children's Hospital.jpg
CHANDOS3.jpg
The Fabs.JPG
Wembley Stadium, illuminated.jpg
</code></pre><h3 id="25-テンプレートの抽出">25. テンプレートの抽出</h3>
<p>記事中に含まれる「基礎情報」テンプレートのフィールド名と値を抽出し，辞書オブジェクトとして格納せよ．</p>
<h5 id="memo-1">memo</h5>
<ul>
<li>何が正解かわからん&hellip;</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">num <span style="color:#f92672">=</span> <span style="color:#ae81ff">999999</span>
<span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> re<span style="color:#f92672">.</span>finditer(<span style="color:#e6db74">&#34;{{基礎情報|{{|}}&#34;</span>,uk_text):
    <span style="color:#66d9ef">if</span> item<span style="color:#f92672">.</span>group() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;{{基礎情報&#34;</span>:
        start <span style="color:#f92672">=</span> item<span style="color:#f92672">.</span>end()
        num<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">elif</span> item<span style="color:#f92672">.</span>group() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;{{&#34;</span>:
        num<span style="color:#f92672">+=</span><span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">elif</span> item<span style="color:#f92672">.</span>group() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;}}&#34;</span>:
        num<span style="color:#f92672">-=</span><span style="color:#ae81ff">1</span>

    <span style="color:#66d9ef">if</span> num <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span>:
        end <span style="color:#f92672">=</span> item<span style="color:#f92672">.</span>start()
        <span style="color:#66d9ef">break</span>

ans <span style="color:#f92672">=</span> dict(re<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;\|(.*?)\ *?=\ ?(.*?)\n&#34;</span>, uk_text[start:end]))
<span style="color:#66d9ef">print</span>(<span style="color:#f92672">*</span>ans<span style="color:#f92672">.</span>items(), sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</code></pre></div><h4 id="out-6">out</h4>
<pre><code>('略名', 'イギリス')
('日本語国名', 'グレートブリテン及び北アイルランド連合王国')
('公式国名', '{{lang|en|United Kingdom of Great Britain and Northern Ireland}}&lt;ref&gt;英語以外での正式国名:&lt;br /&gt;')
('国旗画像', 'Flag of the United Kingdom.svg')
('国章画像', '[[ファイル:Royal Coat of Arms of the United Kingdom.svg|85px|イギリスの国章]]')
('国章リンク', '（[[イギリスの国章|国章]]）')
('標語', '{{lang|fr|[[Dieu et mon droit]]}}&lt;br /&gt;（[[フランス語]]:[[Dieu et mon droit|神と我が権利]]）')
('国歌', &quot;[[女王陛下万歳|{{lang|en|God Save the Queen}}]]{{en icon}}&lt;br /&gt;''神よ女王を護り賜え''&lt;br /&gt;{{center|[[ファイル:United States Navy Band - God Save the Queen.ogg]]}}&quot;)
('地図画像', 'Europe-UK.svg')
('位置画像', 'United Kingdom (+overseas territories) in the World (+Antarctica claims).svg')
('公用語', '[[英語]]')
('首都', '[[ロンドン]]（事実上）')
('最大都市', 'ロンドン')
('元首等肩書', '[[イギリスの君主|女王]]')
('元首等氏名', '[[エリザベス2世]]')
('首相等肩書', '[[イギリスの首相|首相]]')
('首相等氏名', '[[ボリス・ジョンソン]]')
('他元首等肩書1', '[[貴族院 (イギリス)|貴族院議長]]')
('他元首等氏名1', '[[:en:Norman Fowler, Baron Fowler|ノーマン・ファウラー]]')
('他元首等肩書2', '[[庶民院 (イギリス)|庶民院議長]]')
('他元首等氏名2', '{{仮リンク|リンゼイ・ホイル|en|Lindsay Hoyle}}')
('他元首等肩書3', '[[連合王国最高裁判所|最高裁判所長官]]')
('他元首等氏名3', '[[:en:Brenda Hale, Baroness Hale of Richmond|ブレンダ・ヘイル]]')
('面積順位', '76')
('面積大きさ', '1 E11')
('面積値', '244,820')
('水面積率', '1.3%')
('人口統計年', '2018')
('人口順位', '22')
('人口大きさ', '1 E7')
('人口値', '6643万5600&lt;ref&gt;{{Cite web|url=https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates|title=Population estimates - Office for National Statistics|accessdate=2019-06-26|date=2019-06-26}}&lt;/ref&gt;')
('人口密度値', '271')
('GDP統計年元', '2012')
('GDP値元', '1兆5478億&lt;ref name=&quot;imf-statistics-gdp&quot;&gt;[http://www.imf.org/external/pubs/ft/weo/2012/02/weodata/weorept.aspx?pr.x=70&amp;pr.y=13&amp;sy=2010&amp;ey=2012&amp;scsm=1&amp;ssd=1&amp;sort=country&amp;ds=.&amp;br=1&amp;c=112&amp;s=NGDP%2CNGDPD%2CPPPGDP%2CPPPPC&amp;grp=0&amp;a=IMF&gt;Data and Statistics&gt;World Economic Outlook Databases&gt;By Countrise&gt;United Kingdom]&lt;/ref&gt;')
('GDP統計年MER', '2012')
('GDP順位MER', '6')
('GDP値MER', '2兆4337億&lt;ref name=&quot;imf-statistics-gdp&quot; /&gt;')
('GDP統計年', '2012')
('GDP順位', '6')
('GDP値', '2兆3162億&lt;ref name=&quot;imf-statistics-gdp&quot; /&gt;')
('GDP/人', '36,727&lt;ref name=&quot;imf-statistics-gdp&quot; /&gt;')
('建国形態', '建国')
('確立形態1', '[[イングランド王国]]／[[スコットランド王国]]&lt;br /&gt;（両国とも[[合同法 (1707年)|1707年合同法]]まで）')
('確立年月日1', '927年／843年')
('確立形態2', '[[グレートブリテン王国]]成立&lt;br /&gt;（1707年合同法）')
('確立年月日2', '1707年{{0}}5月{{0}}1日')
('確立形態3', '[[グレートブリテン及びアイルランド連合王国]]成立&lt;br /&gt;（[[合同法 (1800年)|1800年合同法]]）')
('確立年月日3', '1801年{{0}}1月{{0}}1日')
('確立形態4', &quot;現在の国号「'''グレートブリテン及び北アイルランド連合王国'''」に変更&quot;)
('確立年月日4', '1927年{{0}}4月12日')
('通貨', '[[スターリング・ポンド|UKポンド]] (£)')
('通貨コード', 'GBP')
('時間帯', '±0')
('夏時間', '+1')
('ISO 3166-1', 'GB / GBR')
('ccTLD', '[[.uk]] / [[.gb]]&lt;ref&gt;使用は.ukに比べ圧倒的少数。&lt;/ref&gt;')
('国際電話番号', '44')
('注記', '&lt;references/&gt;')
</code></pre><h4 id="debug">debug</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">len(list(filter(<span style="color:#66d9ef">lambda</span> x: x<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;|&#34;</span>), uk_text[start:end]<span style="color:#f92672">.</span>splitlines()))) <span style="color:#f92672">==</span> len(ans)
<span style="color:#f92672">&gt;&gt;</span> True
</code></pre></div><h5 id="memo-2">memo</h5>
<ul>
<li>正規表現だけで空白削除頑張った</li>
</ul>
<h3 id="26-強調マークアップの除去-permalink">26. 強調マークアップの除去 Permalink</h3>
<p>25 の処理時に，テンプレートの値から MediaWiki の強調マークアップ（弱い強調，強調，強い強調のすべて）を除去してテキストに変換せよ（参考: マークアップ早見表）．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">new_ans <span style="color:#f92672">=</span> dict((k, re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;&#39;{2,3}|&#39;{5}&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, v)) <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> ans<span style="color:#f92672">.</span>items())
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;before: &#34;</span>, ans<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;確立形態4&#34;</span>))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;after : &#34;</span>, new_ans<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;確立形態4&#34;</span>))
</code></pre></div><h4 id="out-7">out</h4>
<pre><code>before:  現在の国号「'''グレートブリテン及び北アイルランド連合王国'''」に変更
after :  現在の国号「グレートブリテン及び北アイルランド連合王国」に変更
</code></pre><h3 id="27-内部リンクの除去">27. 内部リンクの除去</h3>
<p>26 の処理に加えて，テンプレートの値から MediaWiki の内部リンクマークアップを除去し，テキストに変換せよ（参考: <a href="https://ja.wikipedia.org/wiki/Help:%E6%97%A9%E8%A6%8B%E8%A1%A8">マークアップ早見表</a>）．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">new_ans <span style="color:#f92672">=</span> dict((k, re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;\[\[(?!.*ファイル)(?!.*Category)([^|\]]+\|)*(.*?)\]\]&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">2&#34;</span>, v)) <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> ans<span style="color:#f92672">.</span>items())
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;before: &#34;</span>, ans<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;通貨&#34;</span>))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;after : &#34;</span>, new_ans<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;通貨&#34;</span>))
<span style="color:#66d9ef">print</span>()
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;before: &#34;</span>, ans<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;確立形態3&#34;</span>))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;after : &#34;</span>, new_ans<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;確立形態3&#34;</span>))
</code></pre></div><h4 id="out-8">out</h4>
<pre><code>before:  [[スターリング・ポンド|UKポンド]] (£)
after :  UKポンド (£)

before:  [[グレートブリテン及びアイルランド連合王国]]成立&lt;br /&gt;（[[合同法 (1800年)|1800年合同法]]）
after :  グレートブリテン及びアイルランド連合王国成立&lt;br /&gt;（1800年合同法）
</code></pre><h5 id="memo-3">memo</h5>
<ul>
<li>漏れてる部分</li>
<li><code>{{}}</code>が干渉してそうだから先にこれを置換するのがいいか?</li>
</ul>
<pre><code>before:  [[女王陛下万歳|{{lang|en|God Save the Queen}}]]{{en icon}}&lt;br /&gt;''神よ女王を護り賜え''&lt;br /&gt;{{center|[[ファイル:United States Navy Band - God Save the Queen.ogg]]}}
after :  [[女王陛下万歳|{{lang|en|God Save the Queen}}]]{{en icon}}&lt;br /&gt;''神よ女王を護り賜え''&lt;br /&gt;{{center|[[ファイル:United States Navy Band - God Save the Queen.ogg]]}}
</code></pre><h3 id="28-mediawiki-マークアップの除去">28. MediaWiki マークアップの除去</h3>
<p>27 の処理に加えて，テンプレートの値から MediaWiki マークアップを可能な限り除去し，国の基本情報を整形せよ．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">new_ans <span style="color:#f92672">=</span> dict()
<span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> ans<span style="color:#f92672">.</span>items():
  v <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;&#39;{2,3}|&#39;{5}&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, v) <span style="color:#75715e"># 26</span>
  v <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;{{(.*)\||:?(.*?)}}&#34;</span>, <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">2&#39;</span>, v) <span style="color:#75715e"># {{}} 置換</span>
  v <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;&lt;br\s*?/&gt;&#34;</span>, <span style="color:#e6db74">&#39; &#39;</span>, v) <span style="color:#75715e"># &lt;br /&gt;</span>
  v <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;&lt;ref[^&gt;]*?/&gt;|&lt;ref[^&gt;]*?&gt;.*?/ref&gt;&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, v) <span style="color:#75715e"># &lt;ref&gt;&lt;/ref&gt;, &lt;ref /&gt;</span>
  v <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;\[\[([^|\]]+\|)*(.*?)\]\]&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">2&#34;</span>, v) <span style="color:#75715e"># 27改 ファイルもカテゴリーも置換</span>
  new_ans[k] <span style="color:#f92672">=</span> v
<span style="color:#66d9ef">print</span>(<span style="color:#f92672">*</span>new_ans<span style="color:#f92672">.</span>items(), sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</code></pre></div><h4 id="out-9">out</h4>
<pre><code>('略名', 'イギリス')
('日本語国名', 'グレートブリテン及び北アイルランド連合王国')
('公式国名', 'United Kingdom of Great Britain and Northern Ireland&lt;ref&gt;英語以外での正式国名: ')
('国旗画像', 'Flag of the United Kingdom.svg')
('国章画像', 'イギリスの国章')
('国章リンク', '（国章）')
('標語', '神と我が権利]]）')
('国歌', 'God Save the Queen{{en icon 神よ女王を護り賜え {{center|ファイル:United States Navy Band - God Save the Queen.ogg')
('地図画像', 'Europe-UK.svg')
('位置画像', 'United Kingdom (+overseas territories) in the World (+Antarctica claims).svg')
('公用語', '英語')
('首都', 'ロンドン（事実上）')
('最大都市', 'ロンドン')
('元首等肩書', '女王')
('元首等氏名', 'エリザベス2世')
('首相等肩書', '首相')
('首相等氏名', 'ボリス・ジョンソン')
('他元首等肩書1', '貴族院議長')
('他元首等氏名1', 'ノーマン・ファウラー')
('他元首等肩書2', '庶民院議長')
('他元首等氏名2', 'Lindsay Hoyle')
('他元首等肩書3', '最高裁判所長官')
('他元首等氏名3', 'ブレンダ・ヘイル')
('面積順位', '76')
('面積大きさ', '1 E11')
('面積値', '244,820')
('水面積率', '1.3%')
('人口統計年', '2018')
('人口順位', '22')
('人口大きさ', '1 E7')
('人口値', '6643万5600')
('人口密度値', '271')
('GDP統計年元', '2012')
('GDP値元', '1兆5478億')
('GDP統計年MER', '2012')
('GDP順位MER', '6')
('GDP値MER', '2兆4337億')
('GDP統計年', '2012')
('GDP順位', '6')
('GDP値', '2兆3162億')
('GDP/人', '36,727')
('建国形態', '建国')
('確立形態1', 'イングランド王国／スコットランド王国 （両国とも1707年合同法まで）')
('確立年月日1', '927年／843年')
('確立形態2', 'グレートブリテン王国成立 （1707年合同法）')
('確立年月日2', '1707年{{05月{{01日')
('確立形態3', 'グレートブリテン及びアイルランド連合王国成立 （1800年合同法）')
('確立年月日3', '1801年{{01月{{01日')
('確立形態4', '現在の国号「グレートブリテン及び北アイルランド連合王国」に変更')
('確立年月日4', '1927年{{04月12日')
('通貨', 'UKポンド (£)')
('通貨コード', 'GBP')
('時間帯', '±0')
('夏時間', '+1')
('ISO 3166-1', 'GB / GBR')
('ccTLD', '.uk / .gb')
('国際電話番号', '44')
('注記', '')
</code></pre><h5 id="memo-4">memo</h5>
<ul>
<li>１行に複数該当がある場合に実装もれがある</li>
<li>該当を loop で置換するのがいいか?</li>
<li>疲れたのでここまで</li>
</ul>
<h3 id="29-国旗画像の-url-を取得する">29. 国旗画像の URL を取得する</h3>
<p>テンプレートの内容を利用し，国旗画像の URL を取得せよ．（ヒント: <a href="https://www.mediawiki.org/wiki/API:Main_page/ja">MediaWiki API</a>の<a href="https://www.mediawiki.org/wiki/API:**Imageinfo**">imageinfo</a>を呼び出して，ファイル参照を URL に変換すればよい）</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> requests
URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://en.wikipedia.org/w/api.php&#34;</span>
params <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;action&#34;</span>: <span style="color:#e6db74">&#34;query&#34;</span>,
    <span style="color:#e6db74">&#34;format&#34;</span>: <span style="color:#e6db74">&#34;json&#34;</span>,
    <span style="color:#e6db74">&#34;prop&#34;</span>: <span style="color:#e6db74">&#34;imageinfo&#34;</span>,
    <span style="color:#e6db74">&#34;titles&#34;</span>: <span style="color:#e6db74">&#34;File:&#34;</span><span style="color:#f92672">+</span>ans<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;国旗画像&#34;</span>),
     <span style="color:#e6db74">&#39;iiprop&#39;</span> : <span style="color:#e6db74">&#39;url&#39;</span>,
}
r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(URL, params<span style="color:#f92672">=</span>params)
pages <span style="color:#f92672">=</span> r<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#34;query&#34;</span>][<span style="color:#e6db74">&#34;pages&#34;</span>]
out <span style="color:#f92672">=</span> list(pages<span style="color:#f92672">.</span>values())[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;imageinfo&#34;</span>)[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;url&#34;</span>)
<span style="color:#66d9ef">print</span>(out)
</code></pre></div><h4 id="out-10">out</h4>
<pre><code>https://upload.wikimedia.org/wikipedia/en/a/ae/Flag_of_the_United_Kingdom.svg
</code></pre>
            </div>
        </article>

        <hr />

        <div class="post-info">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://tomowarkar.github.io/blog/tags/nlp">nlp</a></span><span class="tag"><a href="https://tomowarkar.github.io/blog/tags/python">python</a></span><span class="tag"><a href="https://tomowarkar.github.io/blog/tags/regex">regex</a></span>
                </p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>5551 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2020-04-23 14:16 &#43;0900</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h">Read other posts</span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="https://tomowarkar.github.io/blog/posts/nlp100-04/">
                                <span class="button__icon">←</span>
                                <span class="button__text">今さら言語処理100本ノック #04</span>
                            </a>
                        </span>
                    

                    
                        <span class="button next">
                            <a href="https://tomowarkar.github.io/blog/posts/nlp100-02/">
                                <span class="button__text">今さら言語処理100本ノック #02-bash</span>
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    
                </div>
            </div>
        
    </main>
    <div><style>
        .bmc-button img {
            height: 34px !important;
            width: 35px !important;
            margin-bottom: 1px !important;
            box-shadow: none !important;
            border: none !important;
            vertical-align: middle !important;
        }
    
        .bmc-button {
            padding: 7px 10px 7px 10px !important;
            line-height: 35px !important;
            height: 51px !important;
            min-width: 217px !important;
            text-decoration: none !important;
            display: inline-flex !important;
            color: #ffffff !important;
            background-color: #FF5F5F !important;
            border-radius: 5px !important;
            border: 1px solid transparent !important;
            padding: 7px 10px 7px 10px !important;
            font-size: 20px !important;
            letter-spacing: 0.6px !important;
            box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;
            -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
            margin: 0 auto !important;
            font-family: 'Arial', cursive !important;
            -webkit-box-sizing: border-box !important;
            box-sizing: border-box !important;
            -o-transition: 0.3s all linear !important;
            -webkit-transition: 0.3s all linear !important;
            -moz-transition: 0.3s all linear !important;
            -ms-transition: 0.3s all linear !important;
            transition: 0.3s all linear !important;
        }
    
        .bmc-button:hover,
        .bmc-button:active,
        .bmc-button:focus {
            -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
            text-decoration: none !important;
            box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
            opacity: 0.85 !important;
            color: #ffffff !important;
        }
    </style>
    <link href="https://fonts.googleapis.com/css?family=Arial" rel="stylesheet"><a class="bmc-button" target="_blank"
        href="https://www.buymeacoffee.com/tomowarkar"><img src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg"
            alt="Buy me a coffee"><span style="margin-left:15px;font-size:19px !important;">Buy me a coffee</span></a></div>

            </div>

            
                <footer class="footer">
  <div class="footer__inner">
    <div class="footer__content">
      <span>&copy; 2020</span>
      
      <span>tomowarkar</span>
      
    </div>
  </div>
  <div class="footer__inner">
    <div class="footer__content">
      
    </div>
  </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="https://tomowarkar.github.io/blog/bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js" integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script>



    </body>
</html>
